{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm border-0">
    <div class="card-body">
        <h4 class="card-title">üìâ –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h4>
        <p class="text-muted small">–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç—å MLP –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞–ø—Ç–∞–π–º–∞ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
            —Å–µ—Ç–∏ –Ω–∞ 7 –¥–Ω–µ–π.</p>

        {% if analytics_data.error %}
        <div class="alert alert-info">{{ analytics_data.error }}</div>
        {% else %}
        <div style="height: 400px;">
            <canvas id="uptimeChart"></canvas>
        </div>
        {% endif %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('uptimeChart');
    const data = {{ analytics_data | tojson }};

    const labels = [
        ...data.historical.map(d => d.date),
        ...data.predictions.map(d => d.date)
    ];

    const historyPoints = data.historical.map(d => d.online);
    // –ü—Ä–æ–≥–Ω–æ–∑–Ω–∞—è –ª–∏–Ω–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–∞–º, –≥–¥–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è
    const predictionPoints = Array(historyPoints.length - 1).fill(null)
        .concat([historyPoints[historyPoints.length - 1]])
        .concat(data.predictions.map(d => d.predicted_online));

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: '–ò—Å—Ç–æ—Ä–∏—è (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å, %)',
                    data: historyPoints,
                    borderColor: '#0d6efd',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    fill: true,
                    tension: 0.3
                },
                {
                    label: '–ü—Ä–æ–≥–Ω–æ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ (%)',
                    data: predictionPoints,
                    borderColor: '#ffc107',
                    borderDash: [8, 4],
                    tension: 0.3
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    // –£–±–∏—Ä–∞–µ–º –∂–µ—Å—Ç–∫–∏–µ 0 –∏ 100
                    beginAtZero: false,
                    ticks: {
                        callback: function (value) {
                            return value + '%'; // –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞–∫ –ø—Ä–æ—Ü–µ–Ω—Ç–∞
                        }
                    },
                    title: {
                        display: true,
                        text: '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤'
                    },
                    // –û—Å—Ç–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
                    grace: '5%'
                },
                x: {
                    grid: {
                        display: false // –£–±–∏—Ä–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏, —á—Ç–æ–±—ã –Ω–µ —Ä—è–±–∏–ª–æ
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            }
        }
    });
</script>
{% endblock %}