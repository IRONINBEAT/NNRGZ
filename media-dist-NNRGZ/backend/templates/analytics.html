{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <h2 class="mb-4">üìä BI-–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-0 bg-white p-3 text-center">
                <small class="text-muted text-uppercase fw-bold">–í—Å–µ–≥–æ —É–∑–ª–æ–≤</small>
                <h2 class="text-primary mt-1">{{ total_devices }}</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 bg-white p-3 text-center">
                <small class="text-muted text-uppercase fw-bold">–¢–µ–º–ø —Ä–æ—Å—Ç–∞ (–≤ –¥–µ–Ω—å)</small>
                <h2 class="text-success mt-1">+{{ chart_data.metrics.avg_growth }}</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 bg-white p-3 text-center">
                <small class="text-muted text-uppercase fw-bold">–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API</small>
                <h2 class="text-warning mt-1">{{ chart_data.metrics.server_load }}%</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 bg-white p-3 text-center">
                <small class="text-muted text-uppercase fw-bold">–î–Ω–µ–π –∞–Ω–∞–ª–∏–∑–∞</small>
                <h2 class="text-info mt-1">{{ chart_data.metrics.days_monitored }}</h2>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-9">
            <div class="card shadow border-0 p-4 mb-4">
                <h5 class="card-title mb-4">–ü—Ä–æ–≥–Ω–æ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∏ (MLP Regressor)</h5>
                <canvas id="growthChart"></canvas>
            </div>
            <div
                class="alert {% if chart_data.metrics.avg_growth > 1 %}alert-info{% else %}alert-warning{% endif %} border-0 shadow-sm">
                <i class="bi bi-robot"></i>
                {% if chart_data.metrics.avg_growth > 1 %}
                –û–±–Ω–∞—Ä—É–∂–µ–Ω —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ç—Ä–µ–Ω–¥ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–µ—Ç–∏. –ú–æ—â–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π.
                {% else %}
                –¢–µ–º–ø –ø—Ä–∏—Ä–æ—Å—Ç–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —ç—Ç–∞–ø–æ–º
                –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
                {% endif %}
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card shadow border-0 p-4 text-center">
                <h6 class="mb-3">–°—Ç–∞—Ç—É—Å –º–æ—â–Ω–æ—Å—Ç–∏</h6>
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar bg-info" style="width: {{ chart_data.metrics.server_load }}%">
                        {{ chart_data.metrics.server_load }}%
                    </div>
                </div>
                <p class="small text-muted">–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 80% —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–π —É–∑–µ–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('growthChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.labels | tojson }},
        datasets: [
        {
            label: '–†–µ–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è',
            data: {{ chart_data.history | tojson }},
        borderColor: '#0d6efd',
        backgroundColor: 'rgba(13, 110, 253, 0.05)',
        fill: true,
        tension: 0.4
                },
        {
            label: 'AI –ü—Ä–æ–≥–Ω–æ–∑ (7 –¥–Ω–µ–π)',
            data: {{ chart_data.forecast | tojson }},
        borderColor: '#dc3545',
        borderDash: [5, 5],
        pointRadius: 0,
        tension: 0.4
                }
    ]
        },
        options: {
        plugins: { legend: { display: true, position: 'bottom' } },
        scales: { y: { grid: { display: false } } }
    }
    });
</script>
{% endblock %}